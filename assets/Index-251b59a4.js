import{a as g,b as t,__tla as Ne}from"./federation-shared-a49272f9.js";import{E as W,C as Be,d as Oe,S as Ke,a as Ae,b as Pe,c as Te}from"./constants-3149fad0.js";import{u as k,a as Ve,g as G,r as J,i as qe,b as ze,c as y,d as Q,e as Ue,p as Xe,f as Ye,n as $e,h as Fe,j as He,__tla as We}from"./useState-9a390b3c.js";import{useExprValue as f,__tla as Ge}from"./shared-eac49e6b.js";import{C as Je,__tla as Qe}from"./ContainerOutlined-d03408ec.js";import{b as Ze,c as et,d as tt,__tla as nt}from"./useDesginer-c36d80fe.js";import{s as at,a as Z,g as ee,__tla as ot}from"./_virtual___federation_host-7d538dc0.js";import"./babel-e625915d.js";let te,st=Promise.all([(()=>{try{return Ne}catch{}})(),(()=>{try{return We}catch{}})(),(()=>{try{return Ge}catch{}})(),(()=>{try{return Qe}catch{}})(),(()=>{try{return nt}catch{}})(),(()=>{try{return ot}catch{}})()]).then(async()=>{const b=await g("vue"),ne="defineComponent",ae="provide",oe="ref",se="watch",re="h",C=t(b,ne)({props:{element:{type:Object,required:!0}},setup(e){const s=Ze(()=>e.element);t(b,ae)(W,e.element);const i=f(()=>e.element.isRender),u=f(()=>e.element.isShow),r=f(()=>e.element.dynamicStyle),a=f(()=>e.element.dynamicClass),n=t(b,oe)(0);return t(b,se)(()=>e.element.meta,()=>n.value+=1),()=>{var o;return s.value&&i.value!==!1?t(b,re)(s.value,{key:n.value,meta:e.element.meta??{},style:[e.element.style,r.value,{display:u.value!==!1?(o=e.element.style)==null?void 0:o.display:"none"}],class:a.value,"data-uid":e.element.uid}):null}}}),le=await g("@rdx/shared"),p=await g("vue"),ie=await g("naive-ui"),ue="NIcon",de="createVNode",w="createVNode",O="defineComponent",ce="inject",me="onBeforeMount",x="ref",pe="watch",ve="useResizeObserver",ge=t(p,O)({props:{tag:{type:String,default:"div"},virtual:Boolean},setup(e,{slots:s}){const i=k(),u=et(),r=t(p,ce)(W);t(p,me)(()=>{var n;((n=u[r.metaCode])==null?void 0:n.droppable)!==!1&&!r.children&&(r.children=[],i.postMessage({type:"initChildren",data:r.uid}))});const a=n=>e.virtual?n:t(p,de)(e.tag,{},n);return()=>{var n;return s.default?s.default({children:r.children??[],placeholder:t(p,w)(K,{key:"p"},null)}):a((n=r.children)!=null&&n.length?r.children.map(o=>t(p,w)(C,{key:o.uid,element:o},null)):e.virtual?null:[t(p,w)(K,{key:"p"},null)])}}}),K=t(p,O)({setup(){const e=t(p,x)(null),s=t(p,x)(!1),i=t(p,x)(!1);return t(le,ve)(e,u=>{s.value=u.clientWidth<118},{immediate:!0}),t(p,pe)(e,u=>{i.value=!!u}),()=>t(p,w)("div",{class:"unh-h-full un-min-h-34px un-w-full un-flex un-items-center un-justify-center un-whitespace-nowrap un-b-dashed un-b-1px un-border-var(--border-color) un-px-8px un-color-var(--placeholder-color) un-bg-var(--body-color)",ref:e},[i.value?s.value?t(p,w)(t(ie,ue),{size:24,color:"var(--border-color)"},{default:()=>[t(p,w)(Je,null,null)]}):"\u62D6\u62FD\u7EC4\u4EF6\u5230\u6B64\u5904":null])}}),L=await g("vue"),he="ref",A="watch",ye="onMounted";function we(){const e=k(),s=t(L,he)(null),i=()=>{s.value&&(e.boundingRect=s.value.map(a=>{const{left:n,top:o,width:l,height:d}=a.getBoundingClientRect();return{left:n,top:o,width:l,height:d}}))},u=new MutationObserver(()=>{if(e.curElementId===null||!e.curElementId&&!e.curDragCode)return;const a=document.querySelectorAll(`[data-uid="${e.curElementId}"]`);a?(s.value=Array.from(a),e.boundingRect=s.value.map(n=>{const{left:o,top:l,width:d,height:m}=n.getBoundingClientRect();return{left:o,top:l,width:d,height:m}})):(s.value=null,e.boundingRect=null)}),r=new ResizeObserver(a=>{s.value&&(e.boundingRect=a.map(n=>{const{left:o,top:l,width:d,height:m}=n.target.getBoundingClientRect();return{left:o,top:l,width:d,height:m}}))});t(L,A)(s,a=>{r.disconnect(),a?a.forEach(n=>r.observe(n)):e.boundingRect=null},{immediate:!0}),t(L,A)(()=>e.curElementId,a=>{if(a===null||a===0&&!e.isDragging)e.boundingRect=null,s.value=null;else{const n=document.querySelectorAll(`[data-uid="${a}"]`);if(!n)return;s.value=Array.from(n),e.boundingRect=s.value.map(o=>{const{left:l,top:d,width:m,height:h}=o.getBoundingClientRect();return{left:l,top:d,width:m,height:h}})}}),t(L,ye)(()=>{var a;u.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),(a=document.querySelector(".n-scrollbar-container"))==null||a.addEventListener("scroll",i)})}const M=await g("vue"),P="watch",fe="onBeforeMount",be="onUnmounted";function Ee(){const e=k(),s=tt();t(M,P)(()=>e.ctrlKey,n=>{n&&e.curElementId&&Ve(e,G(e))}),t(M,P)(()=>e.curElementId,()=>{e.selectElementIds.clear()});const i=()=>{const n=G(e);!n||n.metaCode==="slot"||e.postMessage({type:"removeChild",data:n.uid})},u=n=>{var l;const{ctrlKey:o}=n;o&&(e.ctrlKey=!0),!["input","textarea"].includes((l=document.activeElement)==null?void 0:l.tagName.toLowerCase())&&(o?n.key==="z"?(n.preventDefault(),e.postMessage({type:"popRollback"})):n.key==="s"&&(n.preventDefault(),e.postMessage({type:"savePage"})):n.key===" "?(n.preventDefault(),e.postMessage({type:"spaceKey"})):n.key==="Delete"&&i())},r=n=>{const{ctrlKey:o}=n;o||(e.ctrlKey=!1)},a=n=>{var o,l;e.pauseKeyEvent||["input","textarea"].includes((o=document.activeElement)==null?void 0:o.tagName.toLowerCase())||e.postMessage({type:"pasteElement",data:(l=n.clipboardData)==null?void 0:l.getData("text/plain")})};t(M,fe)(()=>{document.addEventListener("keydown",u),document.addEventListener("keyup",r),document.addEventListener("copy",s),document.addEventListener("paste",a)}),t(M,be)(()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",r),document.removeEventListener("copy",s),document.removeEventListener("paste",a)})}const _e=await g("@rdx/shared"),v=await g("vue"),Le="shallowReactive",T="provide",Me="shallowRef",Re="computed",ke="nextTick",Ce="onBeforeMount",xe="onUnmounted",De="watch",Ie="toRaw",je="convertListToMap";function Se(e){const s=t(v,Le)({});t(v,T)(Be,s);const i=t(v,Me)([]);t(v,T)(Oe,t(v,Re)(()=>t(_e,je)(i.value,"code")));const u={initState(a){const n=e.postMessage;Object.assign(e,J(!1)),t(v,ke)(()=>{Object.assign(e,a),e.postMessage=n,qe(e,{uid:0,children:e.elements}),e.libs.forEach(async o=>{at?Z(o.name,{external:o.url,format:"esm"}):Z(o.name,{external:o.url.replace(".js","-legacy.js"),format:"systemjs"}),ee(o.name,"./componentMap").then(async l=>{await l.__tla,Object.assign(s,l.default)}),ee(o.name,"./components").then(async l=>{await l.__tla,i.value=i.value.concat(l.default)})})})},changeState(a){e[a.key]=a.value},appendChild(a){ze(e,a.element,y(e,a.parentId))},insertBefore(a){Q(e,a.element,y(e,a.childId))},insertAfter(a){Q(e,a.element,y(e,a.childId),!1)},updateElement(a){const n=y(e,a.uid);Object.assign(n,a)},removeChild(a){Ue(e,y(e,Number(a)))},popRollback(){Xe(e)},pushRollback(){Ye(e,$e)},refresh(){location.reload()}},r=a=>{var n,o;(o=(n=a.data).forEach)==null||o.call(n,l=>u[l.type](l.data))};t(v,Ce)(()=>{window.addEventListener("message",r)}),t(v,xe)(()=>{window.removeEventListener("message",r)}),["ctrlKey","boundingRect","dragPosition"].forEach(a=>{t(v,De)(()=>e[a],n=>{e.postMessage({type:"changeState",data:{key:a,value:t(v,Ie)(n)}})})})}let c,E,V,D,I,_,q,z,j,U,X,R,Y;c=await g("vue"),E="createVNode",V="createTextVNode",D="defineComponent",I="reactive",_="provide",q="toRaw",z="nextTick",j="onBeforeMount",U="watch",X="onUnmounted",te=t(c,D)({setup(){const e=t(c,I)(J(!1));t(c,_)(Ke,e);const s=t(c,I)({});t(c,_)(Ae,s),t(c,_)(Pe,ge),t(c,_)(Te,C),Object.defineProperty(window,"$s",{get(){return t(c,q)(s)}});const i=[];e.postMessage=async r=>{i.push(r),i.length===1&&(await t(c,z)(),parent.postMessage(i),i.length=0)},t(c,j)(()=>e.postMessage({type:"ready"})),Se(e);let u;return t(c,U)(()=>e.globalStyle,r=>{r&&(u||(u=document.createElement("style"),document.head.append(u)),u.innerHTML=r)}),()=>t(c,E)(Y,null,null)}}),R=e=>{for(;e;){if(e.dataset.uid)return e;e=e.parentElement}return null},Y=t(c,D)({setup(){const e=k();Ee(),we();let s=!1;const i=d=>{if(s)s=!1;else{const m=R(d.target);e.postMessage({type:"selectElement",data:m?Number(m.dataset.uid):null})}},u=d=>{if(!e.isDragging)return;const m=R(d.target);if(m){let h=y(e,Number(m.dataset.uid));if(e.curDragId){const S=y(e,e.curDragId);for(;!Fe(e,S,h);)h=He(e,h)}e.postMessage({type:"selectElement",data:h.uid??null})}else e.postMessage({type:"selectElement",data:null})},r=d=>{e.isDragging&&(d.preventDefault(),e.dragPosition={isInner:!0,x:d.clientX,y:d.clientY})},a=()=>{e.isDragging&&(e.isDragging=!1,s=!0,e.postMessage({type:"dropElement"}))},n=d=>{let m=d.target;const{clientX:h,clientY:S}=d,N=B=>{var F;if(B.preventDefault(),!(Math.pow(B.clientX-h,2)+Math.pow(B.clientY-S,2)<8*8||((F=document.getSelection())==null?void 0:F.type)==="Range")){if(m=R(m),m){const H=y(e,Number(m.dataset.uid));H.metaCode!=="slot"&&(e.curDragId=H.uid,e.isDragging=!0,e.postMessage({type:"dragstart",data:e.curDragId}))}window.removeEventListener("mousemove",N)}},$=()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",$)};window.addEventListener("mousemove",N),window.addEventListener("mouseup",$)};t(c,j)(()=>{window.addEventListener("click",i),window.addEventListener("mousedown",n),window.addEventListener("mouseover",u),window.addEventListener("mousemove",r),window.addEventListener("mouseup",a)}),t(c,X)(()=>{window.removeEventListener("click",i),window.removeEventListener("mousedown",n),window.removeEventListener("mouseover",u),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a)});const o=f(()=>e.dynamicStyle),l=f(()=>e.dynamicClass);return()=>t(c,E)("div",{class:l.value,style:[e.style,o.value],"data-uid":"0"},[e.elements.length?e.elements.map(d=>t(c,E)(C,{key:d.uid,element:d},null)):t(c,E)("div",{class:"un-flex un-items-center un-justify-center un-whitespace-nowrap un-color-var(--text-color3) un-b-dashed un-b-1px un-border-var(--border-color) un-p-12px"},[t(c,V)("\u62D6\u62FD\u7EC4\u4EF6\u5230\u6B64\u5904")])])}})});export{st as __tla,te as default};
