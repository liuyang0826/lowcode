import{a as g,b as t,__tla as Ne}from"./federation-shared-a49272f9.js";import{E as W,C as Be,d as Oe,S as Ke,a as Ae,b as Pe,c as Te}from"./constants-3149fad0.js";import{u as k,a as Ve,g as G,r as J,i as qe,b as ze,c as y,d as Q,e as Ue,p as Xe,f as Ye,n as $e,h as Fe,j as He,__tla as We}from"./useState-9a390b3c.js";import{useExprValue as f,__tla as Ge}from"./shared-eac49e6b.js";import{C as Je,__tla as Qe}from"./ContainerOutlined-d03408ec.js";import{b as Ze,c as et,d as tt,__tla as nt}from"./useDesginer-c36d80fe.js";import{d as at}from"./debounce-0459d24a.js";import{s as ot,a as Z,g as ee,__tla as st}from"./_virtual___federation_host-7d538dc0.js";import"./babel-e625915d.js";let te,lt=Promise.all([(()=>{try{return Ne}catch{}})(),(()=>{try{return We}catch{}})(),(()=>{try{return Ge}catch{}})(),(()=>{try{return Qe}catch{}})(),(()=>{try{return nt}catch{}})(),(()=>{try{return st}catch{}})()]).then(async()=>{const b=await g("vue"),ne="defineComponent",ae="provide",oe="ref",se="watch",le="h",C=t(b,ne)({props:{element:{type:Object,required:!0}},setup(e){const s=Ze(()=>e.element);t(b,ae)(W,e.element);const u=f(()=>e.element.isRender),d=f(()=>e.element.isShow),r=f(()=>e.element.dynamicStyle),n=f(()=>e.element.dynamicClass),o=t(b,oe)(0);return t(b,se)(()=>e.element.meta,()=>o.value+=1),()=>{var a;return s.value&&u.value!==!1?t(b,le)(s.value,{key:o.value,meta:e.element.meta??{},style:[e.element.style,r.value,{display:d.value!==!1?(a=e.element.style)==null?void 0:a.display:"none"}],class:n.value,"data-uid":e.element.uid}):null}}}),re=await g("@rdx/shared"),p=await g("vue"),ie=await g("naive-ui"),ue="NIcon",de="createVNode",w="createVNode",O="defineComponent",ce="inject",me="onBeforeMount",x="ref",pe="watch",ve="useResizeObserver",ge=t(p,O)({props:{tag:{type:String,default:"div"},virtual:Boolean},setup(e,{slots:s}){const u=k(),d=et(),r=t(p,ce)(W);t(p,me)(()=>{var o;((o=d[r.metaCode])==null?void 0:o.droppable)!==!1&&!r.children&&(r.children=[],u.postMessage({type:"initChildren",data:r.uid}))});const n=o=>e.virtual?o:t(p,de)(e.tag,{},o);return()=>{var o;return s.default?s.default({children:r.children??[],placeholder:t(p,w)(K,{key:"p"},null)}):n((o=r.children)!=null&&o.length?r.children.map(a=>t(p,w)(C,{key:a.uid,element:a},null)):e.virtual?null:[t(p,w)(K,{key:"p"},null)])}}}),K=t(p,O)({setup(){const e=t(p,x)(null),s=t(p,x)(!1),u=t(p,x)(!1);return t(re,ve)(e,d=>{s.value=d.clientWidth<118},{immediate:!0}),t(p,pe)(e,d=>{u.value=!!d}),()=>t(p,w)("div",{class:"unh-h-full un-min-h-34px un-w-full un-flex un-items-center un-justify-center un-whitespace-nowrap un-b-dashed un-b-1px un-border-var(--border-color) un-px-8px un-color-var(--placeholder-color) un-bg-var(--body-color)",ref:e},[u.value?s.value?t(p,w)(t(ie,ue),{size:24,color:"var(--border-color)"},{default:()=>[t(p,w)(Je,null,null)]}):"\u62D6\u62FD\u7EC4\u4EF6\u5230\u6B64\u5904":null])}}),L=await g("vue"),he="ref",A="watch",ye="onMounted";function we(){const e=k(),s=t(L,he)(null),u=()=>{s.value&&(e.boundingRect=s.value.map(n=>{const{left:o,top:a,width:i,height:l}=n.getBoundingClientRect();return{left:o,top:a,width:i,height:l}}))},d=new MutationObserver(()=>{if(e.curElementId===null||!e.curElementId&&!e.curDragCode)return;const n=document.querySelectorAll(`[data-uid="${e.curElementId}"]`);n?(s.value=Array.from(n),e.boundingRect=s.value.map(o=>{const{left:a,top:i,width:l,height:m}=o.getBoundingClientRect();return{left:a,top:i,width:l,height:m}})):(s.value=null,e.boundingRect=null)}),r=new ResizeObserver(n=>{s.value&&(e.boundingRect=n.map(o=>{const{left:a,top:i,width:l,height:m}=o.target.getBoundingClientRect();return{left:a,top:i,width:l,height:m}}))});t(L,A)(s,n=>{r.disconnect(),n?n.forEach(o=>r.observe(o)):e.boundingRect=null},{immediate:!0}),t(L,A)(()=>e.curElementId,n=>{if(n===null||n===0&&!e.isDragging)e.boundingRect=null,s.value=null;else{const o=document.querySelectorAll(`[data-uid="${n}"]`);if(!o)return;s.value=Array.from(o),e.boundingRect=s.value.map(a=>{const{left:i,top:l,width:m,height:h}=a.getBoundingClientRect();return{left:i,top:l,width:m,height:h}})}}),t(L,ye)(()=>{var n;d.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),(n=document.querySelector(".n-scrollbar-container"))==null||n.addEventListener("scroll",u)})}const M=await g("vue"),P="watch",fe="onBeforeMount",be="onUnmounted";function Ee(){const e=k(),s=tt();t(M,P)(()=>e.ctrlKey,a=>{a&&e.curElementId&&Ve(e,G(e))}),t(M,P)(()=>e.curElementId,()=>{e.selectElementIds.clear()});const u=()=>{const a=G(e);!a||a.metaCode==="slot"||e.postMessage({type:"removeChild",data:a.uid})},d=at(()=>e.postMessage({type:"savePage"}),1e3,{leading:!0,trailing:!1}),r=a=>{var l;const{ctrlKey:i}=a;i&&(e.ctrlKey=!0),!["input","textarea"].includes((l=document.activeElement)==null?void 0:l.tagName.toLowerCase())&&(i?a.key==="z"?(a.preventDefault(),e.postMessage({type:"popRollback"})):a.key==="s"&&(a.preventDefault(),d()):a.key===" "?(a.preventDefault(),e.postMessage({type:"spaceKey"})):a.key==="Delete"&&u())},n=a=>{const{ctrlKey:i}=a;i||(e.ctrlKey=!1)},o=a=>{var i,l;e.pauseKeyEvent||["input","textarea"].includes((i=document.activeElement)==null?void 0:i.tagName.toLowerCase())||e.postMessage({type:"pasteElement",data:(l=a.clipboardData)==null?void 0:l.getData("text/plain")})};t(M,fe)(()=>{document.addEventListener("keydown",r),document.addEventListener("keyup",n),document.addEventListener("copy",s),document.addEventListener("paste",o)}),t(M,be)(()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",n),document.removeEventListener("copy",s),document.removeEventListener("paste",o)})}const _e=await g("@rdx/shared"),v=await g("vue"),Le="shallowReactive",T="provide",Me="shallowRef",Re="computed",ke="nextTick",Ce="onBeforeMount",xe="onUnmounted",De="watch",Ie="toRaw",je="convertListToMap";function Se(e){const s=t(v,Le)({});t(v,T)(Be,s);const u=t(v,Me)([]);t(v,T)(Oe,t(v,Re)(()=>t(_e,je)(u.value,"code")));const d={initState(n){const o=e.postMessage;Object.assign(e,J(!1)),t(v,ke)(()=>{Object.assign(e,n),e.postMessage=o,qe(e,{uid:0,children:e.elements}),e.libs.forEach(async a=>{ot?Z(a.name,{external:a.url,format:"esm"}):Z(a.name,{external:a.url.replace(".js","-legacy.js"),format:"systemjs"}),ee(a.name,"./componentMap").then(async i=>{await i.__tla,Object.assign(s,i.default)}),ee(a.name,"./components").then(async i=>{await i.__tla,u.value=u.value.concat(i.default)})})})},changeState(n){e[n.key]=n.value},appendChild(n){ze(e,n.element,y(e,n.parentId))},insertBefore(n){Q(e,n.element,y(e,n.childId))},insertAfter(n){Q(e,n.element,y(e,n.childId),!1)},updateElement(n){const o=y(e,n.uid);Object.assign(o,n)},removeChild(n){Ue(e,y(e,Number(n)))},popRollback(){Xe(e)},pushRollback(){Ye(e,$e)},refresh(){location.reload()}},r=n=>{var o,a;(a=(o=n.data).forEach)==null||a.call(o,i=>d[i.type](i.data))};t(v,Ce)(()=>{window.addEventListener("message",r)}),t(v,xe)(()=>{window.removeEventListener("message",r)}),["ctrlKey","boundingRect","dragPosition"].forEach(n=>{t(v,De)(()=>e[n],o=>{e.postMessage({type:"changeState",data:{key:n,value:t(v,Ie)(o)}})})})}let c,E,V,D,I,_,q,z,j,U,X,R,Y;c=await g("vue"),E="createVNode",V="createTextVNode",D="defineComponent",I="reactive",_="provide",q="toRaw",z="nextTick",j="onBeforeMount",U="watch",X="onUnmounted",te=t(c,D)({setup(){const e=t(c,I)(J(!1));t(c,_)(Ke,e);const s=t(c,I)({});t(c,_)(Ae,s),t(c,_)(Pe,ge),t(c,_)(Te,C),Object.defineProperty(window,"$s",{get(){return t(c,q)(s)}});const u=[];e.postMessage=async r=>{u.push(r),u.length===1&&(await t(c,z)(),parent.postMessage(u),u.length=0)},t(c,j)(()=>e.postMessage({type:"ready"})),Se(e);let d;return t(c,U)(()=>e.globalStyle,r=>{r&&(d||(d=document.createElement("style"),document.head.append(d)),d.innerHTML=r)}),()=>t(c,E)(Y,null,null)}}),R=e=>{for(;e;){if(e.dataset.uid)return e;e=e.parentElement}return null},Y=t(c,D)({setup(){const e=k();Ee(),we();let s=!1;const u=l=>{if(s)s=!1;else{const m=R(l.target);e.postMessage({type:"selectElement",data:m?Number(m.dataset.uid):null})}},d=l=>{if(!e.isDragging)return;const m=R(l.target);if(m){let h=y(e,Number(m.dataset.uid));if(e.curDragId){const S=y(e,e.curDragId);for(;!Fe(e,S,h);)h=He(e,h)}e.postMessage({type:"selectElement",data:h.uid??null})}else e.postMessage({type:"selectElement",data:null})},r=l=>{e.isDragging&&(l.preventDefault(),e.dragPosition={isInner:!0,x:l.clientX,y:l.clientY})},n=()=>{e.isDragging&&(e.isDragging=!1,s=!0,e.postMessage({type:"dropElement"}))},o=l=>{let m=l.target;const{clientX:h,clientY:S}=l,N=B=>{var F;if(B.preventDefault(),!(Math.pow(B.clientX-h,2)+Math.pow(B.clientY-S,2)<8*8||((F=document.getSelection())==null?void 0:F.type)==="Range")){if(m=R(m),m){const H=y(e,Number(m.dataset.uid));H.metaCode!=="slot"&&(e.curDragId=H.uid,e.isDragging=!0,e.postMessage({type:"dragstart",data:e.curDragId}))}window.removeEventListener("mousemove",N)}},$=()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",$)};window.addEventListener("mousemove",N),window.addEventListener("mouseup",$)};t(c,j)(()=>{window.addEventListener("click",u),window.addEventListener("mousedown",o),window.addEventListener("mouseover",d),window.addEventListener("mousemove",r),window.addEventListener("mouseup",n)}),t(c,X)(()=>{window.removeEventListener("click",u),window.removeEventListener("mousedown",o),window.removeEventListener("mouseover",d),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",n)});const a=f(()=>e.dynamicStyle),i=f(()=>e.dynamicClass);return()=>t(c,E)("div",{class:i.value,style:[e.style,a.value],"data-uid":"0"},[e.elements.length?e.elements.map(l=>t(c,E)(C,{key:l.uid,element:l},null)):t(c,E)("div",{class:"un-flex un-items-center un-justify-center un-whitespace-nowrap un-color-var(--text-color3) un-b-dashed un-b-1px un-border-var(--border-color) un-p-12px"},[t(c,V)("\u62D6\u62FD\u7EC4\u4EF6\u5230\u6B64\u5904")])])}})});export{lt as __tla,te as default};
