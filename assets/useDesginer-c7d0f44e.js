import{a as d,b as l,__tla as V}from"./federation-shared-c16daac1.js";import{u as f,g as y,c as m,j as S,r as Y,i as $,b as W,d as j,e as X,f as Z,l as ee,m as te,__tla as ae}from"./useState-137b4c1b.js";import{C as se,d as ne}from"./constants-278efb7a.js";let A,D,E,K,C,b,R,O,F,P,v,re=Promise.all([(()=>{try{return V}catch{}})(),(()=>{try{return ae}catch{}})()]).then(async()=>{const k=await d("@rdx/shared"),g=await d("vue"),z=await d("@rdx/admin"),B="preferMessage",J="inject",U="computed",q="resolveUnref";R=function(){const e=f(),{createElement:a,insertAfter:n,appendChild:t}=v();return s=>{if(!s)return;const r=JSON.parse(s);if(!r.length)return;const i=y(e)||m(e,0);if(e.curElementId)for(let o=r.length-1;o>=0;o-=1){const c=r[o],h=a({metaCode:c.metaCode,name:c.name,preset:c});n(h,i)}else r.forEach(o=>{const c=a({metaCode:o.metaCode,name:o.name,preset:o});t(c,i)})}},K=function(){const e=f();return a=>{var n,t;if(!(e.pauseKeyEvent||((n=document.getSelection())==null?void 0:n.type)==="Range"))if(e.selectElementIds.size){const s=Array.from(e.selectElementIds).filter(r=>{let i=S(e,m(e,r));for(;i;){if(e.selectElementIds.has(i.uid))return!1;i=S(e,m(e,i.uid))}return!0}).map(r=>m(e,r));(t=a.clipboardData)==null||t.setData("text/plain",JSON.stringify(s)),a.preventDefault()}else e.curElementId&&l(z,B).warning("\u63D2\u69FD\u4E0D\u53EF\u590D\u5236")}},E=function(){return l(g,J)(se)},D=function(e){const a=E();return l(g,U)(()=>{var n,t;return(t=a[(n=l(k,q)(e))==null?void 0:n.metaCode])==null?void 0:t.component})},C=function(){return l(g,J)(ne)};let N,u,p,_;N=await d("@rdx/shared"),u=await d("vue"),p="toRaw",_="treeForEach",b=(e,a,n=0,t)=>{e.forEach((s,r)=>{a(s,e,n,r,t)&&s.children&&b(s.children,a,n+1,s)})};let w=0;function M(){return w+=1}let x,I;O=e=>{e.postMessage({type:"initState",data:{dynamicClass:e.dynamicClass,dynamicStyle:e.dynamicStyle,globalStyle:e.globalStyle,elements:l(u,p)(e.elements),style:l(u,p)(e.style),libs:l(u,p)(e.libs)}})},P=(e,a=!1)=>{const n={dynamicClass:e.dynamicClass,dynamicStyle:e.dynamicStyle,elements:e.elements,style:e.style,globalStyle:e.globalStyle,variables:e.variables};return a?JSON.stringify(n,null,2):JSON.stringify(n)},F=(e,a)=>{const n=e.postMessage,t=e.title,s=e.version,r=e.prodSchema,i=e.originSchema,o=e.libs;Object.assign(e,Y(!0)),a&&Object.assign(e,JSON.parse(a)),e.postMessage=n,e.title=t,e.version=s,e.prodSchema=r,e.originSchema=i,e.libs=o;let c=0;$(e,{uid:0,children:e.elements}),l(N,_)(e.elements,h=>c=Math.max(c,h.uid)),w=c,O(e)},x=await d("@rdx/shared"),I="treeForEach";function G(){return(e,a,n=!0)=>{e&&(n&&Object.assign(a,JSON.parse(JSON.stringify(e)),{uid:a.uid,name:a.name,metaCode:a.metaCode}),l(x,I)(a.children,t=>{t.uid=M()}))}}const H=await d("vue"),L=await d("@rdx/shared"),Q="isString",T="watchEffect";v=function(){const e=f(),a=G(),n=C();return{createElement(t){const s=l(L,Q)(t)?n.value[t]:t,r={uid:M(),name:s.name,metaCode:s.metaCode},i=s.preset;return i&&a(i,r),r},appendChild(t,s=y(e)){W(e,t,s)},insertBefore(t,s){j(e,t,s)},insertAfter(t,s){j(e,t,s,!1)},removeChild(t){X(e,t)},getChildren(t){var s;return(s=m(e,t.uid))==null?void 0:s.children},getCurElement(){return y(e)},getParent(t){return S(e,t)},updateMeta(t,s){const r=JSON.parse(JSON.stringify(s)),i=JSON.stringify(t.meta);Z(e,()=>{t.meta=JSON.parse(i),e.postMessage({type:"updateElement",data:{uid:t.uid,meta:JSON.parse(i)}})}),e.postMessage({type:"pushRollback"}),t.meta=r,e.postMessage({type:"updateElement",data:{uid:t.uid,meta:r}})},pauseShortcut(){e.pauseKeyEvent=!0},continueShortcut(){e.pauseKeyEvent=!1}}},A=function(e){const a=f(),n=a.curElementId;l(H,T)(()=>{n===a.curElementId&&(ee(a,y(a)),e((t,s,r,i=!1)=>{te(a,t,s,r,i)}))})}});export{re as __tla,A as a,D as b,E as c,K as d,C as e,b as f,R as g,O as h,F as o,P as s,v as u};
