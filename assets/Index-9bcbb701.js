import{b as e,a as f,_ as ma,__tla as va}from"./federation-shared-c16daac1.js";import{u as ha,s as ga,a as sa,b as fa,c as ya,C as wa,__tla as xa}from"./TableConfig-1d9e47d0.js";import{E as ka,__tla as Sa}from"./ExpressionInput-ac495609.js";import{b as Na}from"./constants-278efb7a.js";import{r as ba,__tla as _a}from"./useState-137b4c1b.js";import{__tla as qa}from"./ContainerOutlined-36177228.js";import{__tla as Ca}from"./Close-caa3d1b3.js";let da,Ia=Promise.all([(()=>{try{return va}catch{}})(),(()=>{try{return xa}catch{}})(),(()=>{try{return Sa}catch{}})(),(()=>{try{return _a}catch{}})(),(()=>{try{return qa}catch{}})(),(()=>{try{return Ca}catch{}})()]).then(async()=>{const ia=await f("@rdx/shared"),pa="request";async function ca(a){return(await e(ia,pa)({url:"/api/report/setting/getItemById",method:"get",params:a})).data}let b,z,K,j,A,H,$,Q,W,_,M,G,X,Y,Z,ee,ae,te,le,ue,k,t,n,re,oe,ne,se,de,ie,pe,ce,me,ve,he,ge,fe,ye,we,xe,ke,Se,Ne,be,_e,qe,Ce,Ie,o,q,Ue,Be,R,I,Ee,Fe,Oe,ze,Me,Re,Ve,De,Pe,C,Te,Le,U,y,V,l,g,Je,Ke,je,Ae,He,$e,Qe,We,Ge,Xe,Ye,Ze,s,S,ea,D,aa,ta,B,la,E,P,T,L,F,ua,ra,J,oa,na;b=await f("vue"),z="createElementVNode",K="openBlock",j="createElementBlock",A="defineComponent",H={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},$=e(b,z)("g",{fill:"none"},[e(b,z)("path",{d:"M4 5c0-1.007.875-1.755 1.904-2.223C6.978 2.289 8.427 2 10 2s3.022.289 4.096.777C15.125 3.245 16 3.993 16 5v8h-1V6.698a4.92 4.92 0 0 1-.904.525C13.022 7.711 11.573 8 10 8s-3.022-.289-4.096-.777A4.92 4.92 0 0 1 5 6.698V15c0 .374.356.875 1.318 1.313c.708.322 1.646.556 2.712.646c.047.362.15.706.298 1.023c-1.311-.07-2.505-.341-3.424-.76C4.875 16.756 4 16.008 4 15V5zm1 0c0 .374.356.875 1.318 1.313C7.234 6.729 8.536 7 10 7s2.766-.27 3.682-.687C14.644 5.875 15 5.373 15 5c0-.374-.356-.875-1.318-1.313C12.766 3.271 11.464 3 10 3s-2.766.27-3.682.687C5.356 4.125 5 4.627 5 5zm7.5 9a2.5 2.5 0 0 0 0 5h.5a.5.5 0 0 0 0-1h-.5a1.5 1.5 0 0 1 0-3h.5a.5.5 0 0 0 0-1h-.5zm3.5 0a.5.5 0 0 0 0 1h.5a1.5 1.5 0 0 1 0 3H16a.5.5 0 0 0 0 1h.5a2.5 2.5 0 0 0 0-5H16zm-4 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z",fill:"currentColor"})],-1),Q=[$],W=e(b,A)({name:"DatabaseLink20Regular",render:function(a,p){return e(b,K)(),e(b,j)("svg",H,Q)}}),_=await f("vue"),M="createElementVNode",G="openBlock",X="createElementBlock",Y="defineComponent",Z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ee=e(_,M)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),ae=e(_,M)("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1),te=[ee,ae],le=e(_,Y)({name:"Add",render:function(a,p){return e(_,G)(),e(_,X)("svg",Z,te)}}),ue=await f("@rdx/admin"),k=await f("@rdx/shared"),t=await f("vue"),n=await f("naive-ui"),re="NButton",oe="NButton",ne="NButton",se="NPopconfirm",de="NSpace",ie="NFormItem",pe="NFormItem",ce="NFormItem",me="NFormItem",ve="NInput",he="NFormItem",ge="NInput",fe="NFormItem",ye="NInput",we="NFormItem",xe="NSelect",ke="NFormItem",Se="NForm",Ne="NModal",be="NIcon",_e="NButton",qe="NIcon",Ce="NButton",Ie="NDivider",o="createVNode",q="createTextVNode",Ue="mergeProps",Be="defineAsyncComponent",R="defineComponent",I="ref",Ee="watch",Fe="computed",Oe="useModalCtrlLogic",ze="createModalProps",Me="useRequestLogic",Re="request",Ve="convertListToMap",De="useModalLogic",Pe="presetStyleModal",C=e(t,Be)(()=>ma(()=>import("./CodeEditor-d3474a9d.js").then(async a=>(await a.__tla,a)).then(a=>a.C),["./CodeEditor-d3474a9d.js","./federation-shared-c16daac1.js","./CodeEditor-f1c3ba81.css"],import.meta.url).then(a=>a.CodeEditor)),Te=e(t,R)({props:{dataSettings:Array,"onUpdate:dataSettings":Function},setup(a){const{showRef:p,dataRef:i,handleEdit:r}=e(k,Oe)(),h=e(t,I)([]);e(t,Ee)(()=>a.dataSettings,c=>{c?h.value=c.map(u=>{const v=u.dataSetting?JSON.parse(u.dataSetting):{};return{dataSourceId:u.dataSourceId,dataKey:u.dataKey,remark:u.remark,sql:v.sql,query:v.query,dbName:v.dbName,keys:v.keys,http:v.http}}):h.value=[]},{immediate:!0});const w=()=>{var c;(c=a["onUpdate:dataSettings"])==null||c.call(a,h.value.map(u=>({dataSourceId:u.dataSourceId,dataKey:u.dataKey,remark:u.remark,dataSetting:JSON.stringify({sql:u.sql,query:u.query,dbName:u.dbName,keys:u.keys,http:u.http})})))};return()=>e(t,o)("div",{class:"un-flex un-gap-x-8px un-items-center un-ml-8px un-flex-1"},[e(t,o)(e(n,Ie),{vertical:!0},null),e(t,o)("span",null,[e(t,q)("\u6570\u636E\u6E90:")]),h.value.map((c,u)=>e(t,o)(e(n,Ce),{key:u,size:"small",themeOverrides:{paddingSmall:"0 8px"},onClick:()=>r(c)},{default:()=>[e(t,o)(e(n,qe),{size:18,component:W},null)]})),e(t,o)(e(n,_e),{size:"small",themeOverrides:{paddingSmall:"0 8px"},onClick:()=>{h.value.push({})}},{default:()=>[e(t,o)(e(n,be),{size:18,component:le},null)]}),e(t,o)(Le,{show:p.value,"onUpdate:show":c=>p.value=c,data:i.value,onUpdateData:c=>{Object.assign(i.value,c),w()},onDelete:()=>{h.value.splice(h.value.indexOf(i.value),1),w(),p.value=!1}},null)])}}),Le=e(t,R)({props:{...e(k,ze)(),onUpdateData:Function,onDelete:Function},setup(a){const{dataRef:p}=e(k,Me)(async()=>(await e(k,Re)({url:"/api/lowcode/dataSource/options",method:"get"})).data.content,{ready:()=>a.show}),i=e(t,Fe)(()=>e(k,Ve)(p.value,"id")),r=e(t,I)({}),h=e(t,I)(),w={dataSourceId:{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",trigger:["input"]},dataKey:{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636Ekey",trigger:["input"]},sql:{required:!0,message:"\u8BF7\u8F93\u5165sql",trigger:["input"]},query:{required:!0,message:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u6761\u4EF6",trigger:["input"]},dbName:{required:!0,message:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u6570\u636E\u5E93",trigger:["input"]},keys:{required:!0,message:"\u8BF7\u6DFB\u52A0\u67E5\u8BE2key",trigger:["input"]}};e(k,De)({props:a,onShow:()=>{r.value=a.data?JSON.parse(JSON.stringify(a.data)):{}}});const c=async()=>{var u,v,x;await((u=h.value)==null?void 0:u.validate()),(v=a.onUpdateData)==null||v.call(a,r.value),(x=a["onUpdate:show"])==null||x.call(a,!1)};return()=>e(t,o)(e(n,Ne),e(t,Ue)({preset:"card",showIcon:!1,maskClosable:!1,title:"\u914D\u7F6E\u6570\u636E\u6E90",show:a.show,"onUpdate:show":a["onUpdate:show"],style:{width:"calc(100vw - 120px)"},size:"small",autoFocus:!1},e(ue,Pe)),{default:()=>[e(t,o)(e(n,Se),{labelPlacement:"left",labelWidth:"82px",requireMarkPlacement:"left",ref:h,model:r.value,rules:w,class:"un-px-12px un-pt-12px"},{default:()=>{var u,v,x,N,O;return[e(t,o)("div",{class:"un-grid un-grid-cols-2"},[e(t,o)(e(n,ke),{label:"\u6570\u636E\u6E90:",path:"id"},{default:()=>[e(t,o)(e(n,xe),{value:r.value.dataSourceId,"onUpdate:value":d=>r.value.dataSourceId=d,options:p.value,labelField:"name",valueField:"id",filterable:!0},null)]}),e(t,o)(e(n,we),{label:"\u6570\u636Ekey:",path:"key"},{default:()=>[e(t,o)(e(n,ye),{value:r.value.dataKey,"onUpdate:value":d=>r.value.dataKey=d,placeholder:"\u7528\u4E8E\u4ECE\u7ED3\u679C\u4E2D\u83B7\u53D6\u6570\u636E"},null)]})]),e(t,o)(e(n,fe),{label:"\u5907\u6CE8:"},{default:()=>[e(t,o)(e(n,ge),{value:r.value.remark,"onUpdate:value":d=>r.value.remark=d},null)]}),((u=i.value[r.value.dataSourceId])==null?void 0:u.type)===2?e(t,o)(e(n,he),{label:"\u6570\u636E\u5E93:",path:"dbName"},{default:()=>[e(t,o)(e(n,ve),{value:r.value.dbName,"onUpdate:value":d=>r.value.dbName=d},null)]}):null,((v=i.value[r.value.dataSourceId])==null?void 0:v.type)===1?e(t,o)(e(n,me),{label:"\u67E5\u8BE2SQL:",path:"sql"},{default:()=>[e(t,o)(C,{style:"height: calc(100vh - 320px);",class:"un-w-full",value:r.value.sql||`(() => {
  // return "SELECT * FROM test"
})
`,onUpdateValue:d=>r.value.sql=d},null)]}):((x=i.value[r.value.dataSourceId])==null?void 0:x.type)===2?e(t,o)(e(n,ce),{label:"\u67E5\u8BE2\u6761\u4EF6:",path:"query"},{default:()=>[e(t,o)(C,{style:"height: calc(100vh - 320px);",class:"un-w-full",value:r.value.query||`(() => {
  // return \`{ find: "test", filter: {}, skip: 0, limit: 10 }\`
})
`,onUpdateValue:d=>r.value.query=d},null)]}):((N=i.value[r.value.dataSourceId])==null?void 0:N.type)===3?e(t,o)(e(n,pe),{label:"\u67E5\u8BE2key:",path:"keys"},{default:()=>[e(t,o)(C,{style:"height: calc(100vh - 320px);",class:"un-w-full",value:r.value.keys||`(() => {
  // return ['key1', 'key2']             
})
`,onUpdateValue:d=>r.value.keys=d},null)]}):((O=i.value[r.value.dataSourceId])==null?void 0:O.type)===4?e(t,o)(e(n,ie),{label:"\u8BF7\u6C42\u914D\u7F6E:",path:"http"},{default:()=>[e(t,o)(C,{style:"height: calc(100vh - 320px);",class:"un-w-full",value:r.value.http,"onUpdate:value":d=>r.value.http=d,onUpdateValue:d=>r.value.http=d},null)]}):null]}})],footer:()=>e(t,o)(e(n,de),{justify:"end"},{default:()=>[e(t,o)(e(n,se),{onPositiveClick:a.onDelete},{default:()=>[e(t,q)("\u786E\u8BA4\u5220\u9664\uFF1F")],trigger:()=>e(t,o)(e(n,ne),{type:"error"},{default:()=>[e(t,q)("\u5220\u9664")]})}),e(t,o)(e(n,oe),{onClick:()=>{var u;return(u=a["onUpdate:show"])==null?void 0:u.call(a,!1)}},{default:()=>[e(t,q)("\u53D6\u6D88")]}),e(t,o)(e(n,re),{type:"primary",onClick:c},{default:()=>[e(t,q)("\u786E\u5B9A")]})]})})}}),U=await f("@rdx/admin"),y=await f("@rdx/shared"),V=await f("vue-router"),l=await f("vue"),g=await f("naive-ui"),Je="NButton",Ke="NButton",je="NSpace",Ae="NInput",He="NFormItem",$e="NForm",Qe="NModal",We="NForm",Ge="NButton",Xe="NButton",Ye="NButton",Ze="NButton",s="createVNode",S="createTextVNode",ea="mergeProps",D="defineComponent",aa="provide",ta="reactive",B="ref",la="onBeforeMount",E="nextTick",P="useRoute",T="useRequestLogic",L="useSubmitLogic",F="request",ua="useBoolean",ra="createModalProps",J="preferMessage",oa="presetStyleModal",da=e(l,D)({setup(){e(l,aa)(Na,e(l,ta)(ba(!0)));const a=ha(),p=e(V,P)(),i=e(l,B)([]),r=e(l,B)();location.origin.includes("localhost")||location.origin.includes("127.0.0.1")||e(l,la)(()=>{window.onbeforeunload=()=>!0}),e(y,T)(async()=>(await ca({id:p.query.id})).content,{ready:()=>p.query.id,onSuccess(m){m.reportSchema&&ga(a,JSON.parse(m.reportSchema)),i.value=m.dataSettings,r.value=m.nameExpr,document.title=`\u62A5\u8868\u8BBE\u8BA1 - ${m.name}`}});const{loadingRef:h,submit:{handleSubmit:w}}=e(y,L)(async()=>{const m={};sa(m,a),await e(y,F)({url:"/api/report/setting/design",method:"put",data:{id:p.query.id,reportSchema:JSON.stringify(m),nameExpr:r.value,dataSettingDTOS:i.value}})},{onSuccess(){e(U,J).success("\u4FDD\u5B58\u6210\u529F")},manual:!0}),c=async()=>{a.isEditing=!1,await e(l,E)(),window.open(`./#/report-preview?id=${p.query.id}`)},{booleanRef:u,setTrue:v}=e(y,ua)(),{run:x,loadingRef:N}=e(y,T)(async()=>{const m={};sa(m,a),await e(y,F)({url:"/api/report/setting/designDownload",method:"post",responseType:"blob",data:{id:p.query.id,reportSchema:JSON.stringify(m),nameExpr:r.value,dataSettingDTOS:i.value}})},{manual:!0}),O=async()=>{a.isEditing=!1,await e(l,E)(),w()},d=async()=>{a.isEditing=!1,await e(l,E)(),x()};return()=>e(l,s)("div",null,[e(l,s)("div",{class:"un-flex un-items-center un-px-12px un-h-45px un-bg-var(--card-color) un-b-b-1px un-b-b-solid un-border-var(--divider-color)"},[e(l,s)(fa,{simple:!0},null),e(l,s)(Te,{dataSettings:i.value,"onUpdate:dataSettings":m=>i.value=m},null),e(l,s)("div",{class:"un-flex un-items-center un-gap-8px"},[e(l,s)(e(g,Ze),{size:"small",onClick:d,loading:N.value},{default:()=>[e(l,S)("\u4E0B\u8F7D")]}),e(l,s)(e(g,Ye),{size:"small",onClick:c},{default:()=>[e(l,S)("\u9884\u89C8")]}),e(l,s)(e(g,Xe),{size:"small",onClick:O,loading:h.value},{default:()=>[e(l,S)("\u4FDD\u5B58")]}),e(l,s)(e(g,Ge),{size:"small",onClick:v},{default:()=>[e(l,S)("\u53D1\u5E03")]})])]),e(l,s)("div",{class:"un-flex un-w-100vw"},[e(l,s)(ya,{class:"un-flex-1",style:"height: calc(100vh - 45px);"},null),e(l,s)(e(g,We),{size:"small",class:"un-w-240px un-bg-var(--card-color) un-b-l-1px un-b-l-solid un-border-var(--divider-color)"},{default:()=>[e(l,s)("div",{class:"un-px-12px un-pt-12px un-mb--12px"},[e(l,s)(ka,{value:r.value,"onUpdate:value":m=>r.value=m,label:"\u6587\u4EF6\u540D"},null)]),e(l,s)(wa,{simple:!0,style:"height: calc(100vh - 110px);"},null)]})]),e(l,s)(na,{show:u.value,"onUpdate:show":m=>u.value=m,data:{state:a,dataSettings:i.value,nameExpr:r.value}},null)])}}),na=e(l,D)({props:{...e(y,ra)()},setup(a){const p=e(l,B)(),i={remark:{required:!0,message:"\u8BF7\u8F93\u5165\u53D1\u5E03\u5907\u6CE8",trigger:["input"]}},r=e(V,P)(),{loadingRef:h,submit:{modelRef:w,handleSubmit:c}}=e(y,L)(async u=>{var v,x,N;await e(y,F)({url:"/api/report/setting/release",method:"post",data:{id:r.query.id,remark:u.remark,reportSchema:JSON.stringify((v=a.data)==null?void 0:v.state),nameExpr:(x=a.data)==null?void 0:x.nameExpr,dataSettingDTOS:(N=a.data)==null?void 0:N.dataSettings}})},{model:()=>({remark:null}),validate:()=>{var u;(u=p.value)==null||u.validate()},manual:!0,onSuccess(){var u;e(U,J).success("\u53D1\u5E03\u6210\u529F"),(u=a["onUpdate:show"])==null||u.call(a,!1)}});return()=>e(l,s)(e(g,Qe),e(l,ea)({preset:"card",showIcon:!1,maskClosable:!1,title:"\u53D1\u5E03\u62A5\u8868",show:a.show,"onUpdate:show":a["onUpdate:show"],style:{width:"600px"},size:"small",autoFocus:!1},e(U,oa)),{default:()=>[e(l,s)(e(g,$e),{class:"un-mx-12px un-mt-12px",labelPlacement:"left",ref:p,model:w.value,rules:i},{default:()=>[e(l,s)(e(g,He),{path:"remark"},{default:()=>[e(l,s)(e(g,Ae),{type:"textarea",placeholder:"\u53D1\u5E03\u5907\u6CE8",value:w.value.remark,"onUpdate:value":u=>w.value.remark=u},null)]})]})],footer:()=>e(l,s)(e(g,je),{justify:"end"},{default:()=>[e(l,s)(e(g,Ke),{onClick:()=>{var u;return(u=a["onUpdate:show"])==null?void 0:u.call(a,!1)}},{default:()=>[e(l,S)("\u53D6\u6D88")]}),e(l,s)(e(g,Je),{type:"primary",onClick:c,loading:h.value},{default:()=>[e(l,S)("\u786E\u5B9A")]})]})})}})});export{Ia as __tla,da as default};
