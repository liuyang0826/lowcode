{"dynamicClass":"","dynamicStyle":"","elements":[{"uid":15,"name":"变量配置","metaCode":"variable","meta":{"items":[{"uid":1,"name":"nodes","value":"[\r\n  { on: true },\r\n  { branch: true, location: [655.9999999999999, 496.5333251953125] },\r\n  { branch: true, location: [655.9999999999999, 736.5333251953127] },\r\n  { on: true },\r\n  { on: true },\r\n  { on: true },\r\n  { on: true },\r\n  { on: true },\r\n  { on: true },\r\n  { branch: true, location: [1166.4, 557.3333251953125] },\r\n  { branch: true, location: [1166.4, 736.5333251953127] },\r\n  { branch: true, location: [369.59999999999985, 970.1333251953126] },\r\n  { on: true },\r\n  { branch: true, location: [1166.4, 970.1333251953126] },\r\n  { on: true },\r\n  { branch: true, location: [880, 557.3333251953125] },\r\n  { on: true },\r\n  { on: true },\r\n]"},{"uid":2,"name":"edges","value":"[\r\n  { target: 0 },\r\n  { source: 0, target: 1 },\r\n  { source: 1, target: 2 },\r\n  { source: 2, target: 3 },\r\n  { source: 3 },\r\n  { source: 1, target: 4 },\r\n  { source: 4 },\r\n  { source: 2, target: 5 },\r\n  { source: 5 },\r\n  { source: 6 },\r\n  { source: 1, target: 7 },\r\n  { source: 7 },\r\n  { target: 8 },\r\n  { source: 8, target: 9 },\r\n  { source: 9, target: 10 },\r\n  { source: 13, target: 11 },\r\n  { source: 11 },\r\n  { source: 13, target: 12 },\r\n  { source: 12 },\r\n  { source: 10, target: 13 },\r\n  { source: 10, target: 14 },\r\n  { source: 14 },\r\n  { source: 9, target: 15 },\r\n  { source: 15, target: 16 },\r\n  { source: 16 },\r\n  { source: 15, target: 17 },\r\n  { source: 17 },\r\n  { source: 11 },\r\n]"},{"uid":4,"name":"branches","value":"(() => {\r\n  const nodes = $s.nodes?.map((d) => ({ ...d })) ?? []\r\n  $s.edges?.forEach((edge) => {\r\n    if (!edge.on) return\r\n    if (edge.source !== undefined) {\r\n      nodes[edge.source].hasFlow = true\r\n    }\r\n    if (edge.target !== undefined) {\r\n      nodes[edge.target].hasFlow = true\r\n    }\r\n  })\r\n  return nodes.filter((node) => node.branch)\r\n})()\r\n","ref":true},{"uid":3,"name":"switches","value":"$s.nodes.filter((d) => !d.branch)","ref":true}]},"children":[]},{"uid":25,"name":"流向控制","metaCode":"watch","meta":{"source":"$s.nodes","handler":"(nodes) => {\n  const edges = $s.edges\n  if (!edges) return\n\n  const edgeTargets = {}\n  edges.forEach((edge) => {\n    delete edge.on\n    if (edge.target === undefined) return\n    if (!edgeTargets[edge.target]) {\n      edgeTargets[edge.target] = []\n    }\n    edgeTargets[edge.target].push(edge)\n  })\n\n  const nodeMap = {}\n  nodes.forEach((node, index) => {\n    nodeMap[index] = node.branch || node.on\n  })\n\n  const isOpen = (edge) => {\n    if (edge.on !== undefined) return edge.on\n    const edges = edgeTargets[edge.source]\n    edge.on = edges\n      ? edges.filter((edge) => nodeMap[edge.target] && isOpen(edge)).length !== 0\n      : edge.source === undefined || nodeMap[edge.source]\n    return edge.on\n  }\n\n  edges.forEach((edge) => {\n    if (edge.target !== undefined) return\n    isOpen(edge)\n  })\n}\n","deep":true,"immediate":true}},{"uid":29,"name":"普通容器","metaCode":"container","children":[{"uid":23,"name":"循环列表","metaCode":"repeater","children":[{"uid":28,"name":"表单项","metaCode":"formItem","meta":{"label":"字段","props":"({\n  label: $g('repeater').index + ':',\n  showFeedback: false,\n})\n"},"children":[{"uid":24,"name":"开关","metaCode":"switch","meta":{"props":"({\n  value: $g('repeater').item.on,\n  onUpdateValue(value) {\n    $g('repeater').item.on = value\n  }\n})\n"}}]}],"meta":{"data":"$s.switches"}}],"style":{"display":"flex","column-gap":"8px","padding":"0 8px"}},{"uid":1,"name":"画布","metaCode":"canvas","style":{"flex":"1"},"children":[{"uid":48,"name":"线插槽","metaCode":"slot","children":[{"uid":57,"name":"线","metaCode":"line","meta":{"strokeColor":"#9A9A9AFF","lineWidth":9,"points":"$g('canvasGraphic').points","props":"({\n  style: {\n    lineJoin: 'round',\n  },\n  // z:9\n  // shape:{}\n})\n"}},{"uid":40,"name":"线","metaCode":"line","meta":{"points":"$g('canvasGraphic').points","lineWidth":5,"props":"({\n  style: {\n    stroke: $g('canvasGraphic').data.on ? '#4970FF' : '#aaa',\n    lineJoin: 'round',\n  },\n  z: $g('canvasGraphic').data.on ? 9 : 1,\n  // shape:{}\n})\n"}},{"uid":41,"name":"流动动画","metaCode":"lineFlow","meta":{"points":"$g('canvasGraphic').points"},"isRender":"!!$g('canvasGraphic').data.on"}]},{"uid":37,"name":"线插槽","metaCode":"slot","children":[]},{"uid":38,"name":"线插槽","metaCode":"slot","children":[]},{"uid":39,"name":"线插槽","metaCode":"slot","children":[]},{"uid":45,"name":"线插槽","metaCode":"slot","children":[]},{"uid":43,"name":"线插槽","metaCode":"slot","children":[]},{"uid":46,"name":"线插槽","metaCode":"slot","children":[]},{"uid":44,"name":"线插槽","metaCode":"slot","children":[]},{"uid":47,"name":"线插槽","metaCode":"slot","children":[]},{"uid":42,"name":"线插槽","metaCode":"slot","children":[]},{"uid":58,"name":"线插槽","metaCode":"slot","children":[]},{"uid":59,"name":"线插槽","metaCode":"slot","children":[]},{"uid":61,"name":"线插槽","metaCode":"slot","children":[]},{"uid":62,"name":"线插槽","metaCode":"slot","children":[]},{"uid":74,"name":"线插槽","metaCode":"slot","children":[]},{"uid":63,"name":"线插槽","metaCode":"slot","children":[]},{"uid":64,"name":"线插槽","metaCode":"slot","children":[]},{"uid":65,"name":"线插槽","metaCode":"slot","children":[]},{"uid":66,"name":"线插槽","metaCode":"slot","children":[]},{"uid":70,"name":"线插槽","metaCode":"slot","children":[]},{"uid":71,"name":"线插槽","metaCode":"slot","children":[]},{"uid":72,"name":"线插槽","metaCode":"slot","children":[]},{"uid":75,"name":"线插槽","metaCode":"slot","children":[]},{"uid":78,"name":"线插槽","metaCode":"slot","children":[]},{"uid":76,"name":"线插槽","metaCode":"slot","children":[]},{"uid":79,"name":"线插槽","metaCode":"slot","children":[]},{"uid":80,"name":"线插槽","metaCode":"slot","children":[]},{"uid":92,"name":"线插槽","metaCode":"slot","children":[]},{"uid":49,"name":"点插槽","metaCode":"slot","children":[{"uid":53,"name":"点位","metaCode":"point","meta":{"slots":[{"placement":"top","offsetY":"4"}]},"children":[{"name":"内容插槽","metaCode":"slot","children":[{"uid":55,"name":"文本","metaCode":"text","meta":{"content":"'开关' + $g('canvasGraphic').index + ': ' + ($g('canvasGraphic').data.on ? '开启' : '关闭')\r\n","isExpr":true}}],"uid":54}]}]},{"uid":50,"name":"点插槽","metaCode":"slot","children":[]},{"uid":51,"name":"点插槽","metaCode":"slot","children":[]},{"uid":52,"name":"点插槽","metaCode":"slot","children":[]},{"uid":56,"name":"点插槽","metaCode":"slot","children":[]},{"uid":60,"name":"点插槽","metaCode":"slot","children":[]},{"uid":67,"name":"点插槽","metaCode":"slot","children":[]},{"uid":69,"name":"点插槽","metaCode":"slot","children":[]},{"uid":73,"name":"点插槽","metaCode":"slot","children":[]},{"uid":77,"name":"点插槽","metaCode":"slot","children":[]},{"uid":81,"name":"点插槽","metaCode":"slot","children":[]},{"uid":87,"name":"循环列表","metaCode":"repeater","children":[{"uid":91,"name":"普通容器","metaCode":"container","children":[{"uid":88,"name":"文本","metaCode":"text","meta":{"content":""},"style":{"width":"5px","height":"5px","position":"absolute","background-color":"#4970FF","border-radius":"50%"},"dynamicStyle":""}],"dynamicStyle":"({\r\n  left: ~~$g('canvasCoord').coordX($g('repeater').item.location[0]) + 0.5 + 'px',\r\n  top: ~~$g('canvasCoord').coordY($g('repeater').item.location[1]) + 0.5 + 'px',\r\n})\r\n","style":{"position":"absolute","transform":"translate(-50%, -50%)","display":"flex","justify-content":"center","align-items":"center"},"isRender":"!!$g('repeater').item.hasFlow"}],"meta":{"data":"$s.branches"},"isRender":""}],"meta":{"elements":[{"uid":57,"name":"线插槽","type":"line","points":[[174.39999999999986,285.3333251953125],[369.59999999999985,285.3333251953125]],"variableKey":"edges","slotIndex":0},{"uid":45,"name":"线插槽","type":"line","points":[[369.59999999999985,285.3333251953125],[535.9999999999999,285.3333251953125],[535.9999999999999,496.5333251953125],[655.9999999999999,496.5333251953125]],"slotIndex":1,"variableKey":"edges"},{"uid":47,"name":"线插槽","type":"line","points":[[655.9999999999999,496.5333251953125],[763.1999999999998,496.5333251953125],[763.1999999999998,285.3333251953125],[1007.9999999999998,285.3333251953125],[1007.9999999999998,736.5333251953127],[655.9999999999999,736.5333251953127]],"slotIndex":2,"variableKey":"edges"},{"uid":48,"name":"线插槽","type":"line","points":[[655.9999999999999,736.5333251953127],[535.9999999999999,736.5333251953127],[535.9999999999999,848.5333251953125],[369.59999999999985,848.5333251953125]],"slotIndex":3,"variableKey":"edges"},{"uid":56,"name":"线插槽","type":"line","points":[[369.59999999999985,848.5333251953125],[174.39999999999986,848.5333251953125]],"variableKey":"edges","slotIndex":4},{"uid":50,"name":"线插槽","type":"line","points":[[655.9999999999999,496.5333251953125],[655.9999999999999,195.73332519531252],[1007.9999999999998,195.73332519531252]],"variableKey":"edges","slotIndex":5},{"uid":52,"name":"线插槽","type":"line","points":[[1007.9999999999998,195.73332519531252],[1147.2,195.73332519531252],[1166.4,176.5333251953125],[1185.6000000000001,195.73332519531252],[1673.6,195.73332519531252]],"variableKey":"edges","slotIndex":6},{"uid":51,"name":"线插槽","type":"line","points":[[655.9999999999999,736.5333251953127],[655.9999999999999,848.5333251953125],[1007.9999999999998,848.5333251953125]],"variableKey":"edges","slotIndex":7},{"uid":54,"name":"线插槽","type":"line","points":[[1007.9999999999998,848.5333251953125],[1147.2,848.5333251953125],[1166.4,829.3333251953125],[1185.6000000000001,848.5333251953125],[1673.6,848.5333251953125]],"variableKey":"edges","slotIndex":8},{"uid":49,"name":"线插槽","type":"line","points":[[1358.3999999999999,285.3333251953125],[1358.3999999999999,496.5333251953125],[1673.6,496.5333251953125]],"variableKey":"edges","slotIndex":9},{"uid":64,"name":"线插槽","type":"line","points":[[655.9999999999999,496.5333251953125],[655.9999999999999,643.7333251953125],[988.7999999999997,643.7333251953125],[1007.9999999999998,624.5333251953125],[1027.1999999999998,643.7333251953125],[1147.2,643.7333251953125],[1166.4,624.5333251953125],[1185.6000000000001,643.7333251953125],[1505.6,643.7333251953125]],"variableKey":"edges","slotIndex":10},{"uid":65,"name":"线插槽","type":"line","points":[[1505.6,643.7333251953125],[1673.6,643.7333251953125]],"variableKey":"edges","slotIndex":11},{"uid":68,"name":"线插槽","type":"line","points":[[1166.4,67.73332519531252],[1166.4,285.3333251953125]],"variableKey":"edges","slotIndex":12},{"uid":69,"name":"线插槽","type":"line","points":[[1166.4,285.3333251953125],[1166.4,557.3333251953125]],"variableKey":"edges","slotIndex":13},{"uid":83,"name":"线插槽","type":"line","points":[[1166.4,557.3333251953125],[1166.4,736.5333251953127]],"variableKey":"edges","slotIndex":14},{"uid":70,"name":"线插槽","type":"line","points":[[1166.4,970.1333251953126],[369.59999999999985,970.1333251953126]],"variableKey":"edges","slotIndex":15},{"uid":71,"name":"线插槽","type":"line","points":[[369.59999999999985,970.1333251953126],[174.39999999999986,970.1333251953126]],"variableKey":"edges","slotIndex":16},{"uid":72,"name":"线插槽","type":"line","points":[[1166.4,970.1333251953126],[1505.6,970.1333251953126]],"variableKey":"edges","slotIndex":17},{"uid":73,"name":"线插槽","type":"line","points":[[1505.6,970.1333251953126],[1673.6,970.1333251953126]],"variableKey":"edges","slotIndex":18},{"uid":78,"name":"线插槽","type":"line","points":[[1166.4,736.5333251953127],[1166.4,970.1333251953126]],"variableKey":"edges","slotIndex":19},{"uid":80,"name":"线插槽","type":"line","points":[[1166.4,736.5333251953127],[1505.6,736.5333251953127]],"variableKey":"edges","slotIndex":20},{"uid":81,"name":"线插槽","type":"line","points":[[1505.6,736.5333251953127],[1673.6,736.5333251953127]],"variableKey":"edges","slotIndex":21},{"uid":84,"name":"线插槽","type":"line","points":[[1166.4,557.3333251953125],[1027.1999999999998,557.3333251953125],[1007.9999999999998,538.1333251953124],[988.7999999999997,557.3333251953125],[880,557.3333251953125]],"variableKey":"edges","slotIndex":22},{"uid":87,"name":"线插槽","type":"line","points":[[880,557.3333251953125],[675.1999999999999,557.3333251953125],[655.9999999999999,538.1333251953124],[636.7999999999998,557.3333251953125],[369.59999999999985,557.3333251953125]],"variableKey":"edges","slotIndex":23},{"uid":85,"name":"线插槽","type":"line","points":[[369.59999999999985,557.3333251953125],[174.39999999999986,557.3333251953125]],"variableKey":"edges","slotIndex":24},{"uid":88,"name":"线插槽","type":"line","points":[[880,557.3333251953125],[880,395.7333251953125],[782.3999999999999,395.7333251953125],[763.1999999999998,376.5333251953125],[743.9999999999998,395.7333251953125],[675.1999999999999,395.7333251953125],[655.9999999999999,376.5333251953125],[636.7999999999998,395.7333251953125],[555.1999999999999,395.7333251953125],[535.9999999999999,376.5333251953125],[516.7999999999998,395.7333251953125],[369.59999999999985,395.7333251953125]],"variableKey":"edges","slotIndex":25},{"uid":89,"name":"线插槽","type":"line","points":[[369.59999999999985,395.7333251953125],[174.39999999999986,395.7333251953125]],"variableKey":"edges","slotIndex":26},{"uid":91,"name":"线插槽","type":"line","points":[[369.59999999999985,970.1333251953126],[369.59999999999985,1015.1279199110122]],"slotIndex":27,"variableKey":"edges"},{"uid":59,"name":"点插槽","type":"point","location":[369.59999999999985,285.3333251953125],"variableKey":"switches","slotIndex":28},{"uid":60,"name":"点插槽","type":"point","location":[369.59999999999985,848.5333251953125],"variableKey":"switches","slotIndex":29},{"uid":61,"name":"点插槽","type":"point","location":[1007.9999999999998,195.73332519531252],"variableKey":"switches","slotIndex":30},{"uid":62,"name":"点插槽","type":"point","location":[1007.9999999999998,848.5333251953125],"variableKey":"switches","slotIndex":31},{"uid":63,"name":"点插槽","type":"point","location":[1505.6,496.5333251953125],"variableKey":"switches","slotIndex":32},{"uid":67,"name":"点插槽","type":"point","location":[1505.6,643.7333251953125],"variableKey":"switches","slotIndex":33},{"uid":74,"name":"点插槽","type":"point","location":[1166.4,285.3333251953125],"variableKey":"switches","slotIndex":34},{"uid":76,"name":"点插槽","type":"point","location":[1505.6,970.1333251953126],"variableKey":"switches","slotIndex":35},{"uid":82,"name":"点插槽","type":"point","location":[1505.6,736.5333251953127],"variableKey":"switches","slotIndex":36},{"uid":86,"name":"点插槽","type":"point","location":[369.59999999999985,557.3333251953125],"variableKey":"switches","slotIndex":37},{"uid":90,"name":"点插槽","type":"point","location":[369.59999999999985,395.7333251953125],"variableKey":"switches","slotIndex":38}],"scopeKey":"canvas","dpr":4}}],"style":{"display":"flex","flex-direction":"column","height":"100vh"},"globalStyle":"","variables":[{"code":"item","name":"$g('repeater').item","remark":"循环数据","isScoped":true,"elementId":23},{"code":"index","name":"$g('repeater').index","remark":"循环数据下标","isScoped":true,"elementId":23},{"code":"item","name":"$g('repeater').item","remark":"循环数据","isScoped":true,"elementId":87},{"code":"index","name":"$g('repeater').index","remark":"循环数据下标","isScoped":true,"elementId":87},{"code":"0","name":"$s.nodes","remark":"变量1","isScoped":false,"elementId":15},{"code":"1","name":"$s.edges","remark":"变量2","isScoped":false,"elementId":15},{"code":"2","name":"$s.branches","remark":"变量3","isScoped":false,"elementId":15},{"code":"3","name":"$s.switches","remark":"变量4","isScoped":false,"elementId":15},{"code":"coord","name":"$g('canvasCoord')","remark":"坐标系","isScoped":true,"elementId":1},{"code":"points","name":"$g('canvasGraphic').points","remark":"图形坐标","isScoped":true,"elementId":1},{"code":"data","name":"$g('canvasGraphic').index","remark":"图形数据下标","isScoped":true,"elementId":1}]}